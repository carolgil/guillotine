<% @latex_config={:parse_twice => true} %>
\usepackage{geometry}
\geometry{margin=1in}
\usepackage{graphicx}
\usepackage[absolute]{textpos}
\usepackage{tikz}
\usetikzlibrary{calc}

\renewcommand{\arraystretch}{1.3}
\newcommand{\blank}{ \rule{.7in}{.5pt}\hspace{.05in}}
\title{}

\begin{document}
\pagestyle{empty}
\singlespace


<% @pledgers.each do |pledger| %>
  <% my_donations = (@donations & pledger.donations).sort_by{|d| d.amount}.reverse %>
  <% my_donation_total = my_donations.inject(0) {|sum,don| sum+don.amount} %>
  <% many_donations = (my_donations.length > 11) %>
  <% my_donations = my_donations[0..10] %>
  <% hidden_donations_total = my_donation_total - my_donations.inject(0) {|sum,don| sum+don.amount} %>
  <% my_rewards = @rewards & pledger.rewards %>
  \newpage

  \begin{textblock*}{2in}[0,0](1in,0.75in)
    \includegraphics[width=2in]{wcbn}
  \end{textblock*}
  \begin{textblock*}{1.5in}[1,0](7.75in,0.86in)
    \raggedright\Small
    \textbf{Cameron Bothner}\\
    Development Director
    \texttt{dd@wcbn.org}
  \end{textblock*}
  \begin{tikzpicture}[remember picture,overlay]
    \draw[color=black,line width=2pt] (current page.north west)+(3.25in,-1.08in) -- ($(-2.45in,-1.08in)+(current page.north east)$);
  \end{tikzpicture}

  \vspace{.5in}
  \begin{center}
    \bfseries \scshape Thank You for Donating to WCBN
  \end{center}
  \vspace{.1in}
  Thank you kindly for your generous donation to WCBN-FM! You can be sure we'll make good use of it stocking the New Music Shelf, keeping the tables turning and feeding the hamster that keeps the transmitter transmitting.

  Please take a moment to ensure that our contact and demographic information about you is correct. Please write in corrections if needed.

  \vspace{8pt}
  \begin{tabularx}{1\textwidth}{|XX|}
      \hline
      \multicolumn{2}{|X|}{\textbf{Name: }<%=lesc pledger.name%>}\\
      \textbf{Email Address: }\texttt{<%=lesc pledger.email%>} & 
        \textbf{WCBN Affiliation:} <%=lesc pledger.affiliation.capitalize%>\\
      \textbf{Telephone:} <%=lesc pledger.perm_phone%> & \\
      \parbox{0.4\textwidth}{\vspace{4pt}
        \textbf{Address:}\\
        <%=lesc pledger.name %>\\
        <%=lesc pledger.perm_address%>\\
        <% if !pledger.perm_address2.blank? %>
          <%=lesc pledger.perm_address2%>\\
        <% end %>
        <%= lesc pledger.perm_city%>, <%=lesc pledger.perm_state%> <%= lesc pledger.perm_zip %>
        \vspace{4pt}} & \\
      \hline
  \end{tabularx}

  \begin{table}[h]
  \centering
  \subfloat{%
  \begin{tabularx}{.45\textwidth}{|X|l|}
      \hline
      \textbf{Itemized Donations}&\textbf{Amount}\\
      \hline\hline
      <% my_donations.each do |d| %>
        <%= lesc d.slot.show.name %> &
        \$<%= number_with_precision(d.amount, delimiter: ',', precision: 2) %>\\
      <% end %>
      <% if many_donations %>
        \hline Various other shows & 
        \$<%= number_with_precision(hidden_donations_total, delimiter: ',', precision: 2) %>\\
      <% end %>
      \hline\hline
      \textbf{Total:} &\textbf{\$<%= number_with_precision(my_donation_total, delimiter:',', precision:2)%>}\\\hline
  \end{tabularx}
  }%
  \qquad%
  \subfloat{%
  \begin{tabularx}{.45\textwidth}[t!]{|X|}
      \hline
      \textbf{Requested Premium Item}\\
      \hline\hline
      <% my_rewards.each do |r| %>
        <%= lesc r.item.name %>\\
      <% end %>
      \hline
  \end{tabularx}
  }
  \end{table}

  \begin{centering}
  Please make checks payable to ``WCBN,''\\and include this form when you send your payment to:\\\textbf{WCBN-FM\\530 Student Activities Building\\Ann Arbor, MI 48109\\}
  \end{centering}
  \vspace{12pt} Look for a thank you note and a receipt from us when your payment has been received. Thank you so very much for your generous donation.

  We love you! Keep listening.
<% end %>

\end{document}
